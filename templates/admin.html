<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">

    <!-- PWA -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#1e3a8a">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome CDN estável -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <title>Painel Administrativo - MOB</title>
</head>

<body class="bg-gray-50 min-h-screen">

<header class="bg-white p-4 shadow-sm flex justify-between items-center">
    <h1 class="text-xl font-bold text-blue-900">Painel Administrativo</h1>
    <a href="/dashboard" class="text-blue-600 font-semibold">Voltar</a>
</header>

<main class="max-w-6xl mx-auto p-6">

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">

        <table class="w-full text-sm">
            <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
                <tr>
                    <th class="p-3 text-left">ID</th>
                    <th class="p-3 text-left">Nome</th>
                    <th class="p-3 text-left">Email</th>
                    <th class="p-3 text-left">WhatsApp</th>
                    <th class="p-3 text-center">Anotações</th>
                    <th class="p-3 text-center">Ações</th>
                </tr>
            </thead>

            <tbody>
                {% for user in users %}
                <tr class="border-t hover:bg-gray-50">
                    <td class="p-3">{{ user.id }}</td>
                    <td class="p-3 font-semibold">{{ user.name }}</td>
                    <td class="p-3">{{ user.email }}</td>
                    <td class="p-3">{{ user.whatsapp }}</td>
                    <td class="p-3 text-center">{{ user.notes|length }}</td>

                    <td class="p-3 text-center">
                        <div class="flex justify-center items-center gap-4">

                            {% if not user.is_admin %}
                            <a href="/admin/promover/{{ user.id }}"
                               title="Tornar administrador"
                               class="text-purple-600 hover:text-purple-800 text-lg transition transform hover:scale-110">
                                <i class="fa-solid fa-user-shield"></i>
                            </a>
                            {% endif %}

                            <a href="/admin/export/{{ user.id }}"
                               title="Baixar dados"
                               class="text-blue-600 hover:text-blue-800 text-lg transition transform hover:scale-110">
                                <i class="fa-solid fa-file-arrow-down"></i>
                            </a>

                            <a href="/admin/edit/{{ user.id }}"
                               title="Editar usuário"
                               class="text-yellow-600 hover:text-yellow-800 text-lg transition transform hover:scale-110">
                                <i class="fa-solid fa-user-pen"></i>
                            </a>

                            <a href="/admin/delete/{{ user.id }}"
                               title="Excluir usuário"
                               onclick="return confirm('Tem certeza que deseja excluir este usuário?')"
                               class="text-red-600 hover:text-red-800 text-lg transition transform hover:scale-110">
                                <i class="fa-solid fa-user-xmark"></i>
                            </a>

                            {% if user.is_admin %}
                            <a href="/admin/remover-admin/{{ user.id }}"
                               title="Remover privilégio admin"
                               class="text-gray-600 hover:text-gray-800 text-lg transition transform hover:scale-110">
                                <i class="fa-solid fa-user-minus"></i>
                            </a>
                            {% endif %}

                        </div>
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

</main>

<!-- Service Worker -->
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('{{ url_for("static", filename="sw.js") }}')
        .then(() => console.log('Service Worker registrado'))
        .catch(err => console.log('Erro no SW:', err));
}
</script>

</body>
</html>